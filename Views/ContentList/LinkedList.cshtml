@model Ignia.Topics.Web.Mvc.TopicViewModel

@{
  Layout = "~/Views/Layout/_Layout.cshtml";
}

@section PageBodySection {

  <section class="panel body">

    <!-- Body Content -->
    <article class="page body">
      @Html.Raw(HttpUtility.HtmlDecode(@Model.Topic.Attributes.Get("Body")))
    </article>
    <!-- /Body Content -->

    @if (Model.Topic.Attributes.Contains("Categories") && Model.Topic["Categories"] != null && Model.Topic["Categories"].Count > 0) {
      foreach (Ignia.Topics.Topic category in Model.Topic["Categories"]) {
        <h1><a name="@category.Key"></a>@category.Title</h1>
        <section id="Group-@category.Key" class="content list">
          @foreach (Ignia.Topics.Topic contentItem in Model.Topic["ContentItems"].Where(t => t.Attributes.Get("Category", "").Equals(category))) {
            @WriteContentItem(contentItem, "h2")
          }
        </section>
      }
    }
    else {
      <section class="content list">
        @foreach (Ignia.Topics.Topic contentItem in Model.Topic["ContentItems"]) {
          @WriteContentItem(contentItem)
        }
      </section>
    }

  </section>

}

@helper WriteContentItem(Ignia.Topics.Topic contentItem, string element = "h1") {
  <article>
    @if (!String.IsNullOrWhiteSpace(contentItem.Attributes.Get("ThumbnailImage"))) {
      <a href="@contentItem.Attributes.Get("LearnMoreUrl", "#")" target="_blank">
        <!-- Thumbnail Image -->
        <picture class="callout picture thumbnail small">
          <source srcset="@contentItem.Attributes.Get("ThumbnailImage")" />
          <img src="@contentItem.Attributes.Get("ThumbnailImage")" alt="@contentItem.Title">
        </picture>
        <!-- /Thumbnail Image -->
      </a>
    }
    <div>
      <@element id="@contentItem.Key" class="link"><a href="@contentItem.Attributes.Get("LearnMoreUrl", "#")">@contentItem.Title</a><@("/" + element)>
      @Html.Raw(HttpUtility.HtmlDecode(@contentItem.Attributes.Get("Description")))
    </div>
  </article>
}

<!--
  Content Type: Content List
  View Type: Linked List
  View Location: ~/Views/ContentList/LinkedList.cshtml
-->
