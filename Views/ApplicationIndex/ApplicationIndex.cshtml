@model Ignia.Topics.Web.Mvc.TopicViewModel

@{
  Layout = "~/Views/Layout/_Layout.cshtml";
}

@section PageBodySection {

  <!--
  <section class="panel body">
    @Html.Raw(HttpUtility.HtmlDecode(@Model.Topic.Attributes.Get("Body")))
  </section>
  --> 

  <section class="panel accordion">
    <ul class="accordion applications" data-accordion>

      @foreach (var category in getApplications().GroupBy(t => t.Attributes.Get("Category")).ToList()) { 

      <!-- @category.Key -->
      <li class="accordion-item @(isFirst()? "is-active" : "")" data-accordion-item>
        <a class="accordion-title" href="#">@category.Key</a>

        <!-- Environmental Applications -->
        <div class="accordion-content" data-tab-content>
          <div class="grid-x grid-margin-x" data-equalizer data-equalize-on="small">

            @foreach (Ignia.Topics.Topic application in category) {
              <div class="medium-6 cell">
                <div class="card application">
                  <i class="type icon application" aria-hidden="true"></i>
                  <a href="@application.WebPath" class="thumbnail" style="background-image: url('@application.Attributes.Get("ThumbnailImage", "")')">&nbsp;</a>
                  <a href="@application.WebPath" class="title" data-equalizer-watch>@application.Title</a>
                </div>
              </div>
            }

          </div>
        </div>
        <!-- /@category Applications -->

      </li>

      }

    </ul>
  </section>

}

@functions {

  List<Ignia.Topics.Topic> getApplications() {
    List<Ignia.Topics.Topic> applicationPages = new List<Ignia.Topics.Topic>();
    foreach (Ignia.Topics.Topic topic in @Model.Topic.SortedChildren) {
      foreach (Ignia.Topics.Topic childTopic in topic.SortedChildren) {
        if (childTopic.Attributes.Get("ContentType").Equals("ApplicationPage") && !applicationPages.Contains(childTopic)) {
          applicationPages.Add(childTopic);
        }
      }
    }
    return applicationPages;
  }

  bool _isFirst = true;
  bool isFirst() {
    if (_isFirst) {
      _isFirst = false;
      return true;
    }
    return false;
  }

}

<!--
  Content Type: Application List
  View Location: ~/Views/ApplicationIndex/ApplicationIndex.cshtml
-->