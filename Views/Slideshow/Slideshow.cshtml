@model TopicViewModel

@{
  ViewBag.Title = Model.Topic.Title;
  Layout = "~/Views/Layout/_Layout.cshtml";
}

@section Head {
  <link rel="stylesheet" type="text/css" href="/Shared/Styles/Vendor/OwlCarousel/owl.carousel.min.css" />
  <link rel="stylesheet" type="text/css" href="/Shared/Styles/Vendor/OwlCarousel/owl.theme.default.min.css">
  <link rel="stylesheet" type="text/css" href="/Shared/Styles/Views/Slideshow.css" />
}

@section PostTitleSection {
  <!-- Controls -->
  <!-- @Model.Topic.Attributes.Get("TransitionEffect") -->
}

@section PageBodySection {
  <section class="panel body">
    <!-- <p>@Html.Raw(@Model.Topic.Attributes.Get("Body"))</p> -->
    <div class="carousel-wrapper">
      <div class="owl-carousel">
        @if (Model.Topic["ContentItems"] != null && Model.Topic["ContentItems"].Count > 0) {
          foreach (Topic contentItem in Model.Topic["ContentItems"].SortedChildren) {
            @WriteContentItem(contentItem)
          }
        }
      </div>
      <div class="owl-nav bottom">
        <div class="owl-prev custom">
          <button class="button large primary">Prev</button>
        </div>
        <div class="owl-next custom">
          <button class="button large primary">Next</button>
        </div>
      </div>
    </div>
  </section>
}

@section Scripts {
  <script src="~/Shared/Scripts/Vendor/OwlCarousel/owl.carousel.js"></script>
  <script>
    $(function () {

      /**
       * Instatiate carousel
       */
      var $carousel             = $('.owl-carousel');
      $carousel.owlCarousel({
        items: 1,
        margin: 0,
        nav: true,
        navText: [
          '<button class="button large primary">Prev</button>',
          '<button class="button large primary">Next</button>',
        ],
        dots: true,
        dotsEach: 1
      });

      /**
       * Recalculate carousel stage height
       */
      adjustStageHeight($('.owl-item.active article.slide').outerHeight());
      $carousel.on('translated.owl.carousel', function (event) {
        adjustStageHeight($('.owl-item.active article.slide').outerHeight());
      });

      /**
       * Clear navigation button focus
       */
      $('.owl-prev, .owl-next').click(function () {
        $(this).find('button').blur();
      });

    });

    /**
     * Adjust carousel stage height based on height of active slide
     */
    function adjustStageHeight(activeSlideHeight) {
      $('div.owl-stage-outer').height(activeSlideHeight);
    }

  </script>
}

@helper WriteContentItem(Topic contentItem, string element = "h1") {
  <article class="slide">
    @if (!String.IsNullOrWhiteSpace(contentItem.Attributes.Get("ThumbnailImage"))) {
    <!-- Thumbnail Image -->
    <picture class="callout picture thumbnail small">
      <source srcset="@contentItem.Attributes.Get("ThumbnailImage")" />
      <img src="@contentItem.Attributes.Get("ThumbnailImage")" alt="@contentItem.Title">
    </picture>
    <!-- /Thumbnail Image -->
    }
    @Html.Raw(HttpUtility.HtmlDecode(@contentItem.Attributes.Get("Description")))
    @if (!String.IsNullOrWhiteSpace(contentItem.Attributes.Get("LearnMoreUrl"))) {
      <p><a href="@contentItem.Attributes.Get("LearnMoreUrl")" target="_blank">Learn More</a></p>
    }
  </article>
}
<!--
  Content Type: Slideshow
  View Location: ~/Views/Slideshow/Slideshow.cshtml
-->
